<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Effective Frontend testing</title>
<meta name="Description" content="Progressive Web App talk's slides">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#5B9BD5">

<link rel="icon" type="image/png" sizes="60x60 72x72" href="img/icons/icon-72x72.png">
<link rel="icon" type="image/png" sizes="96x96" href="img/icons/icon-96x96.png">
<link rel="icon" type="image/png" sizes="192x192" href="img/icons/icon-192x192.png">

<meta name="twitter:site" content="@maxpou">
<meta name="twitter:title" content="Progressive web apps">

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="css/bootstrap-grid.min.css">
<link rel="stylesheet" href="css/github.css">
<link rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat" >
<link rel="stylesheet" href="css/font-awesome.min.css">

<!-- Printing and PDF exports -->
<script>
var link  = document.createElement( 'link' );
link.rel  = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
document.getElementsByTagName('head')[0].appendChild(link);
</script>
</head>
<body>
<div class="reveal">
<div class='footer'>
  <a href="https://twitter.com/_maxpou"><i class="fa fa-twitter"></i> @_maxpou</a>
</div>
<div class="slides container">
<section>
  <section>
    <h2>Effective Frontend testing</h2>
    <p class="me-link">
      Maxence Poutord - <a href="https://twitter.com/_maxpou"><i class="fa fa-twitter"></i> @_maxpou</a>
    </p>
  </section>
  <section>
    <h2>Slides, links, etc.</h2>
    <h2><a href="https://www.maxpou.fr/talks/">maxpou.fr/talks/</a></h2>
  </section>
</section>
<section>
  <section>
    <h2>Why not to test?</h2>
    <ul class="unstyled">
      <li class="fragment">â³ "We don't have time to test!"</li>
      <li class="fragment">ğŸŒ "Test slow me down!" (creation + maintenance)</li>
      <li class="fragment">ğŸ¤·â€â™‚ï¸ "We don't know how to test and what to test!"</li>
    </ul>
  </section>
  <section>
    <h2>ğŸ’ª Why we need test</h2>
    <ul class="unstyled">
      <li class="fragment">ğŸ¤— Confidence</li>
      <li class="fragment">ğŸ“– Document codebase</li>
      <li class="fragment">ğŸ‘Š Helps to write better code</li>
      <li class="fragment">ğŸ’¸ Reduce maintenance cost</li>
      <li class="fragment">ğŸ» Deploy to prod on Friday? Why not!</li>
    </ul>
    <aside class="notes">
      <li>Gives **confidence** that software works as expected. So it's easier to remove/refactor code</li>
      <li>Document codebase (unit) and application behavior (e2e).</li>
      <li>Might helps to write better code (i.e. "wtf I did when I wrote this function?")</li>
      <li>Reduce maintenance app so the Money (see cost of bug). </li>
      <li>Deploy to prod on Friday? Where's the problem?</li>
    </aside>
  </section>
  <section data-background="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRM6GwuL_ubkAVrDBkZ5D2trpo1Mgn82H1gneU_LSv25lb6qIrt">
    <h2 style="text-shadow: 1px 1px 4px rgba(34,34,34,.6);">The importance of automation</h2>
    <aside class="notes">
      every code change must be sent through PR. No commit on master.
      automatically trigger build on PR
      coverage thresholds for new code
      if test fail, don't remove it. Fix it!
    </aside>
  </section>
</section>
<section>
  <section>
    <h2>Testing pyramid</h2>
    <img src="./img/testing-pyramid.png" alt="Testing pyramid">
  </section>
  <section>
    <h2>Testing Trophy</h2>
    <img src="./img/testing-trophy.jpg" alt="Testing Trophy" style="width: 50%;">
    <p>Â© Kent C. Dodds</p>
  </section>
  <!-- <section>
    <h2>Unit tests vs. Integration vs. e2e</h2>
  </section> -->
  <section>
    <h2>Hey, what about static testing?</h2>
    <p>
      <span class="fragment">Yes I know it can be annoying...</span>
      <span class="fragment">but it catches:</span>
    </p>

    <ul class="unstyled">
      <li class="fragment">ğŸ‘ dumb errors <br><i>(== instead of ===, unused variables...)</i></li>
      <li class="fragment">ğŸ‘ avoid steril debates <br><i>(tab vs space, semicolons or not...)</i></li>
    </ul>
    <p class="fragment">â¡ Helps to focus on what really matter â¤ï¸</p>
  </section>
</section>
<section>
  <section>
    <h2>Unit tests</h2>
    <video playsinline="" controls="controls" data-paused-by-reveal="" loop="loop" data-autoplay="" data-lazy-loaded="" controlslist="nodownload" src="https://video.twimg.com/tweet_video/CLlxtWaUMAAVBKv.mp4"></video>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const basket = [
    { item: 'ğŸº', price: 3 },
    { item: 'ğŸ”', price: 5.5 }
  ]

  expect(vatCalculator(basket)).toBe(1.3)
});
      </code>
    </pre>
  </section>
  <section>
    <h2>Jest</h2>
    <i>Because using 3 packages for testing is confusing</i>
  </section>
  <section>
    <h2>How to test component?</h2>
    <p>Treat your component as a black box:</p>
    <ul>
      <li class="fragment">props</li>
      <li class="fragment">events (click, select...)</li>
      <li class="fragment">lifecycle events (mounted, destroyed...)</li>
      <li class="fragment">event emitted</li>
      <li class="fragment">output (DOM)</li>
      <li class="fragment">props pass to subcomponents</li>
      <li class="fragment"><span class="fragment strike">Internal state (data, computed properties)</span></li>
      <p class="fragment">ğŸ‘‰ if public API doesn't change, we should refactor component without changing tests!</p>
    </ul>
  </section>
  <section>
    <h2>Definition of a good test</h2>
    <ul class="unstyled">
      <li class="fragment">ğŸŸ Dead simple</li>
      <li class="fragment">ğŸ›Œ Cover the most common usages</li>
      <li class="fragment">âš¡ï¸ Lightning fast (nobody like to wait!)</li>
      <li class="fragment">ğŸ¤¯ Doesn't test external library</li>
    </ul>
    <aside class="notes">
      1. no complexity
      2. its ok not to reach 100%cc
    </aside>
  </section>
  <section>
    <h2>Code coverage (cc)</h2>
    <img src="https://lostechies.com/content/derickbailey/uploads/2011/03/image_72328864.png" alt="">
  </section>
  <section>
    <h2>ğŸ‘Œ Following cc evolution</h2>
    <img src="./img/coverage-evolution.png" alt="Following cc evolution" style="width: 70%;">
    <p><a href="https://github.com/maxpou/gitvub/pull/36" target="_blank" rel="noopener noreferrer">github.com/maxpou/gitvub/pull/36</a></p>
  </section>
  <section>
    <h2>ğŸ’© Code coverage bullshit</h2>
    <img src="./img/cc-bs.png" alt="Code coverage bullshit" style="width: 50%;">
    <p>High coverage !== code quality</p>
  </section>
  <section>
    <h2>ğŸ’© Code coverage bullshit</h2>
    <pre>
      <code>
function add (a, b) {
  launchNuclearMissile()
  return a + b
}

// ...
test('add.js', () => {
  assert(add(1, 2)).toBe(3)
});
      </code>
    </pre>
  </section>
  <section>
    <h2>ğŸ’© Code coverage bullshit</h2>
    <pre><code>
function foo(a, unitTest = false) {
  // code

  if (weirdAndHardToConditionToTest || unitTest) {
    // code
  }

  return bar;
}
    </code></pre>
  </section>
</section>
<section>
  <section>
    <h2>ğŸ“¸ Snapshot testing</h2>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const basket = [
    { item: 'ğŸº', price: 3 },
    { item: 'ğŸ”', price: 5.5 }
  ]
  console.log(vatCalculator(basket))
});
      </code>
    </pre>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const basket = [
    { item: 'ğŸº', price: 3 },
    { item: 'ğŸ”', price: 5.5 }
  ]
  expect(vatCalculator(basket)).toBe(3.55)
});
      </code>
    </pre>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const basket = [
    { item: 'ğŸº', price: 3 },
    { item: 'ğŸ”', price: 5.5 }
  ]
  expect(vatCalculator(basket)).toMatchSnapshot()
});
      </code>
    </pre>
    <pre class="fragment"><code>
// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`return the expected VAT 1`] = `3.5`;        
    </code></pre>
  </section>
  <section>
    <img src="./img/snap.png" alt="snapshot">
  </section>
  <section>
    <h2>ğŸ‘ Good usecase</h2>
    <pre><code>
it('should render correctly', () => {
  const wrapper = shallowMount(Alert, {
    propsData: {
      message: 'Test message',
    },
  });
  expect(wrapper.html()).toMatchSnapshot();
});      

exports[`Alert.vue should render correctly 1`] = `
"<div role=\\"alert\\" class=\\"alert alert-danger\\"><!---->
  Test message
</div>"
`;
    </code></pre>
  </section>
  <section>
    <h2>Misconceptions</h2>
    <ul class="unstyled">
      <li class="fragment">ğŸ‘€ Snapshot testing is NOT visual regression testing</li>
      <li class="fragment">ğŸ’ğŸ»â€â™€ï¸ Not only for DOM testing!!!</li>
      <li class="fragment">ğŸ™…â€â™‚ï¸ Purpose is not to replace existing assertions. <br>
        â¡ lazy way to provide test where there's not!
      </li>
      <li class="fragment">ğŸ‘ Donâ€™t fall into the temptation of quickly update snapshot without checking the real change!</li>
    </ul>
  </section>
  <section>
    <h2>ğŸ¤” Huge Snapshot?</h2>
    <ul class="unstyled">
      <li class="fragment">ğŸ Tests are about <b>confidence</b></li>
      <li class="fragment">ğŸ™…â€â™€ï¸ Nobody like to review huge snapshots</li>
      <li class="fragment">ğŸ‘ Use something else! (or <code>shallowMount</code>)</li>
    </ul>
    <br>
    <p class="fragment">ğŸ‘Œ eslint: <a href="https://github.com/jest-community/eslint-plugin-jest/blob/master/docs/rules/no-large-snapshots.md" target="_blank" rel="noopener noreferrer">jest/no-large-snapshots (default: 12 lines)</a></p>
  </section>
</section>
<section>
  <section>
    <h2>Integration test</h2>
    <ul>
      <li>dumb components ==> unit tests</li>
      <li>containers (router, store) ===> integration tests</li>
    </ul>
  </section>
  <section>
    <h2>Benefits</h2>
    <img src="https://cdn-images-1.medium.com/max/1600/1*UtZzMT32fRMnSN-HmgiSVQ.gif" alt="unit vs. integration test" style="width: 80%;">
  </section>
  <section>
    <h2>Example in VueJS</h2>
    <pre>
      <code>
import { mount, createLocalVue } from '@vue/test-utils'
import VueRouter from 'vue-router'

const localVue = createLocalVue()

localVue.use(VueRouter)
localVue.use(Vuex)
const router = new VueRouter()

const store = new Vuex.Store({
  state: {},
})

mount(Component, {
  localVue,
  router,
  store,
})
      </code>
    </pre>
  </section>
  <section>
    <h2>About: Async tests</h2>
    <pre class="fragment">
      <code class="javascript" data-trim data-noescape>
test('should render an page with data', async () => {
  <mark>expect.assertions(1)</mark>

  const wrapper = mount(StudentList, {
    localVue,
    router,
    store,
    sync: false,
  })
  <mark>await flushPromises()</mark>
  
  expect(wrapper.html()).toMatchSnapshot()
  // extra security (avoid empty table in snapshot)
  expect(wrapper.text()).toContain('Ralph Wiggum')
})

      </code>
    </pre>
  </section>
  <section>
    <h2>About mock</h2>
    <ul class="unstyled">
      <li class="fragment">ğŸ‘ Mocks sucks</li>
      <li class="fragment">ğŸ¤ Ok for:</li>
      <ul class="unstyled">
        <li class="fragment">External calls (HTTP GET/POST/...)</li>
        <li class="fragment">Browsers API (local/session storage, navigator...)</li>
      </ul>
    </ul>
    <aside class="notes">
      mock sucks. avoid them as much as posible.
      Every time we mock, we diverge from the real world scenario.
      only for external calls (HTTP GET/POST/...) and browsers API (local/session storage, navigator...)    
    </aside>
  </section>
</section>
<!-- <section>
  <section>
    <h2>e2e</h2>
  </section>
  <section>
    <h2>example</h2>
    ... complicated test...
  </section>
  <section>
    <h2>Chrome --headless</h2>
    <h3>A new game changer</h3>
  </section>
</section> -->
<section>
  <section>
    <h3>Don't forget the most important</h3>
    <h2 class="fragment">we write tests to catch bugs ğŸ›</h2>
  </section>
  <section>
    <h3>If your test is red,</h3>
    <h2 class="fragment">don't delete it, fix it!</h2>
    <pre class="fragment">
      <code class="javascript" data-trim data-noescape>
// it('should...', () => {
//   expect(actions.resetStore).toHaveBeenCalled();
//   expect(actions.getXXX).toHaveBeenCalled();
//   expect(actions.getYYY).toHaveBeenCalled();
// });
      </code>
    </pre>


  </section>
  <section>
    <h2>Thank you!</h2>
  </section>
</section>
<section>
  <section>
    <h2>Backup</h2>
  </section>
  <section>
      https://www.youtube.com/watch?v=zqdCM8zR6Mc
  </section>
</section>
</div>
</div>
<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available at:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
  controls: false,
  progress: true,
  slideNumber: true,
  history: true,

  transition: 'fade', // none/fade/slide/convex/concave/zoom

  // Optional reveal.js plugins
  dependencies: [
    { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
    { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
    { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
    { src: 'reveal.js/plugin/notes/notes.js', async: true }
  ]
});

</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67868977-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
