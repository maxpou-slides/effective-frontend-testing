<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Effective Frontend Testing</title>
<meta name="Description" content="Effective Frontend Testing slides">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#5B9BD5">

<link rel="icon" type="image/png" sizes="60x60 72x72" href="img/icons/icon-72x72.png">
<link rel="icon" type="image/png" sizes="96x96" href="img/icons/icon-96x96.png">
<link rel="icon" type="image/png" sizes="192x192" href="img/icons/icon-192x192.png">

<meta name="twitter:site" content="@maxpou">
<meta name="twitter:title" content="Effective Frontend Testing">

<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="css/bootstrap-grid.min.css">
<link rel="stylesheet" href="css/github.css">
<link rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat" >
<link rel="stylesheet" href="css/font-awesome.min.css">

<!-- Printing and PDF exports -->
<script>
var link  = document.createElement( 'link' );
link.rel  = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
document.getElementsByTagName('head')[0].appendChild(link);
</script>
</head>
<body>
<div class="reveal">
<div class='footer'>
  <a href="https://twitter.com/_maxpou"><i class="fa fa-twitter"></i> @_maxpou</a>
</div>
<div class="slides container">
<section>
  <section>
    <h2>Effective Frontend Testing</h2>
    <p class="me-link">
      Maxence Poutord - <a href="https://twitter.com/_maxpou"><i class="fa fa-twitter"></i> @_maxpou</a>
    </p>
  </section>
  <section>
    <h2>Slides, links, etc.</h2>
    <h2><a href="https://www.maxpou.fr/speaking/">maxpou.fr/speaking/</a></h2>
  </section>
  <section>
    <h2>👋 Hey I'm Max</h2>
    <br>
    <ul class="unstyled">
      <li>👨🏼‍💻 Sr. Frontend Engineer @VSware (Vue.js)</li>
      <li>🎒 Digital Nomad & ✈️ Serial Traveler</li>
      <li>🍺 Beer appreciator</li>
    </ul>
  </section>
  <section>
    <h2>Effective Frontend Testing</h2>
    <p class="me-link">
      Maxence Poutord - <a href="https://twitter.com/_maxpou"><i class="fa fa-twitter"></i> @_maxpou</a>
    </p>
  </section>
</section>
<section>
  <section>
    <h2>Why not to test?</h2>
    <ul class="unstyled">
      <li class="fragment">⏳ "We don't have time to test!"</li>
      <li class="fragment">🐌 "Test slow me down!" (creation + maintenance)</li>
      <li class="fragment">🤷‍♂️ "We don't know how to test and what to test!"</li>
    </ul>
  </section>
  <section>
    <h2>💪 Why we need test</h2>
    <ul class="unstyled">
      <li class="fragment">🤗 Confidence</li>
      <li class="fragment">📖 Document codebase</li>
      <li class="fragment">👊 Helps to write better code</li>
      <li class="fragment">💸 Reduce maintenance cost</li>
      <li class="fragment">🍻 Deploy to prod on Friday? Why not!</li>
    </ul>
    <aside class="notes">
      <li>Gives **confidence** that software works as expected. So it's easier to remove/refactor code</li>
      <li>Document codebase (unit) and application behavior (e2e).</li>
      <li>Might helps to write better code (i.e. "wtf I did when I wrote this function?")</li>
      <li>Reduce maintenance app so the Money (see cost of bug). </li>
      <li>Deploy to prod on Friday? Where's the problem?</li>
    </aside>
  </section>
</section>
<section>
  <section>
    <h2>Testing pyramid</h2>
    <img src="./img/testing-pyramid.png" alt="Testing pyramid">
  </section>
  <section>
    <h2>Testing in reality</h2>
    <img src="./img/testing-dorito.jpg" style="width: 40%" alt="testing dorito">
    <p><small><a href="https://twitter.com/denvercoder/status/960752578198843392">https://twitter.com/denvercoder/status/960752578198843392</a></small></p>
  </section>
  <section>
    <h2>Testing pyramid</h2>
    <img src="./img/testing-pyramid.png" alt="Testing pyramid">
  </section>
  <section>
    <h2>...but...</h2>
    <img src="./img/titanic.jpg" alt="titanic" style="width: 100%;">
  </section>
  <section>
    <h2>Testing Trophy</h2>
    <img src="./img/testing-trophy.png" alt="Testing Trophy" style="width: 45%;">
    <p>© Kent C. Dodds</p>
  </section>
</section>
<section>
  <section>
    <h2>Static Testing</h2>
  </section>
  <section>
    <h2>ESLint</h2>
    <p>
      <span class="fragment">Yes I know it can be annoying...</span>
      <span class="fragment">but it catches:</span>
    </p>
    <ul class="unstyled">
      <li class="fragment">👍 dumb errors <br><i>(== instead of ===, unused variables...)</i></li>
      <li class="fragment">👍 avoid steril debates / bikeshedding <br><i>(tab vs space, semicolons...)</i></li>
    </ul>
    <br>
    <p class="fragment">➡ Helps to focus on what really matter ❤️</p>
    <br>
    <p class="fragment">👨🏻‍💼 easily extendable - <i>i.e. companies internal rules</i> </p>
  </section>
  <section>
    <h2>Flow</h2>
  </section>
</section>
<section>
  <section>
    <h2>Unit tests</h2>
    <video playsinline="" controls="controls" data-paused-by-reveal="" loop="loop" data-autoplay="" data-lazy-loaded="" controlslist="nodownload" src="https://video.twimg.com/tweet_video/CLlxtWaUMAAVBKv.mp4" style="width: 70%;"></video>
  </section>
  <section>
    <h2>Tips: use Jest</h2>
    <i>Because using 3 packages for testing is confusing</i>
  </section>
  <section>
    <h2>Example</h2>
    <img src="./img/unit-example-aaa.png" alt="unit-example">
    <aside class="notes">
      <code>
const vatCalculator = require('./vatCalculator')

it('should return the expected VAT', () => {
  const menu = [
    { item: '🍺', price: 3 },
    { item: '🍔', price: 5.5 }
  ]

  const vat = vatCalculator(basket)

  expect(vat).toBe(1.3)
});
      </code>
    </aside>
    <p class="fragment">Method AAA - Arrange-Act-Assert</p>
  </section>
  <section>
    <h2>How to test component?</h2>
    <p>Treat your component as a <span class="text-info-bold">black box</span>:</p>
    <ul>
      <li class="fragment">props</li>
      <li class="fragment">events (onClick, onSelect...)</li>
      <li class="fragment">lifecycle events (mounted, destroyed...)</li>
      <li class="fragment">event emitted</li>
      <li class="fragment">output (DOM)</li>
      <li class="fragment">props pass to subcomponents</li>
      <li class="fragment"><span class="fragment strike">Internal state (data, computed properties)</span></li>
      <p class="fragment">👉 if public API doesn't change, we should refactor component without changing tests!</p>
    </ul>
  </section>
  <section>
    <h2>Definition of a good test</h2>
    <ul class="unstyled">
      <li class="fragment">🐟 Dead simple</li>
      <li class="fragment">⚡️ Lightning fast (nobody like to wait!)</li>
      <li class="fragment">🤯 Doesn't test external library</li>
      <li class="fragment">🛌 Cover the most common usages</li>
    </ul>
    <aside class="notes">
      1. no complexity
      2. its ok not to reach 100%cc
    </aside>
  </section>
</section>
<section>
  <section>
    <h2>Code Coverage</h2>
    <p>example of report</p>
  </section>
  <section>
    <h3>How code coverage works is generated?</h3>
    <img src="./img/how-cc-works.png" style="width: 80%;" class="fragment" alt="how-cc-works part 1">
    <img src="./img/how-cc-works-2.png" style="width: 80%;" class="fragment" alt="how-cc-works part 2">
  <aside class="notes">
    https://blog.npmjs.org/post/178487845610/rethinking-javascript-test-coverage
    <code>
function foo (a) {
  if (a) {
    // do something with 'a'.
  } else {
    // do something else.
  }
}
    </code>
    <code>
function foo(a) {
  cov_2mofekog2n.f[0]++;
  cov_2mofekog2n.s[0]++;
  if (a) {
    // do something with 'a'.
    cov_2mofekog2n.b[0][0]++;
  } else {
    // do something else.
    cov_2mofekog2n.b[0][1]++;
  }
}
    </code>
  </aside>
  </section>
  <section>
    <h2>How much?</h2>
    <img src="./img/cc-sweet-pot.png" class="fragment" alt="cc and sweet pot">
  </section>
  <section>
    <h2>💩 Code coverage bullshit</h2>
    <img src="./img/cc-bs.png" alt="Code coverage bullshit" style="width: 50%;">
    <p>High coverage !== bug proof</p>
  </section>
  <section>
    <h2>💩 Code coverage bullshit</h2>
    <img src="./img/cc-side-effect.png" style="width: 100%;" alt="cc-side-effect">
    <aside class="notes">
        <code>
// add.js
function add (a, b) {
  launchNuclearMissile()
  return a + b
}

// add.test.js
test('add.js', () => {
  assert(add(1, 2)).toBe(3)
});
      </code>
    </aside>
  </section>
  <section>
    <h2>💩 Code coverage bullshit</h2>
    <pre><code>
function foo(a, unitTest = false) {
  // code

  if (weirdAndHardToConditionToTest || unitTest) {
    // code
  }

  return bar;
}
    </code></pre>
  </section>
  <section>
    <h2>😳 Testing privates functions</h2>
    ...
  </section>
  <section>
    <h2>⏱ Be careful with metrics</h2>
    cc is good but is JUST one metric. 
  </section>
</section>
<section>
  <section>
    <h2>📸 Snapshot testing</h2>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const menu = [
    { item: '🍺', price: 3 },
    { item: '🍔', price: 5.5 }
  ]
  console.log(vatCalculator(menu))
});
      </code>
      <code class="fragment">
// 3.5
      </code>
    </pre>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const menu = [
    { item: '🍺', price: 3 },
    { item: '🍔', price: 5.5 }
  ]
  expect(vatCalculator(menu)).toBe(3.55)
});
      </code>
    </pre>
  </section>
  <section>
    <h2>Example</h2>
    <pre>
      <code>
const vatCalculator = require('./vatCalculator')

it('return the expected VAT', () => {
  const menu = [
    { item: '🍺', price: 3 },
    { item: '🍔', price: 5.5 }
  ]
  expect(vatCalculator(menu)).toMatchSnapshot()
});
      </code>
    </pre>
    <pre class="fragment"><code>
// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`return the expected VAT 1`] = `3.5`;        
    </code></pre>
  </section>
  <section>
    <img src="./img/snap.png" alt="snapshot">
  </section>
  <section>
    <h2>👍 Good usecase</h2>
    <pre><code>
it('should render correctly', () => {
  const wrapper = shallowMount(Alert, {
    propsData: {
      message: 'Test message',
    },
  });
  expect(wrapper.html()).toMatchSnapshot();
});      

exports[`Alert.vue should render correctly 1`] = `
"<div role=\\"alert\\" class=\\"alert alert-danger\\"><!---->
  Test message
</div>"
`;
    </code></pre>
  </section>
  <section>
    <h2>Misconceptions</h2>
    <ul class="unstyled">
      <li class="fragment">👀 Snapshot testing is NOT visual regression testing</li>
      <li class="fragment">💁🏻‍♀️ Not only for DOM testing!!!</li>
      <li class="fragment">🙅‍♂️ Purpose is not to replace existing assertions. <br>
        ➡ lazy way to provide test where there's not!
      </li>
      <li class="fragment">🐑 Don’t fall into the temptation of quickly update snapshot without checking the real change!</li>
    </ul>
  </section>
  <section>
    <h2>🤔 Huge Snapshot?</h2>
    <ul class="unstyled">
      <li class="fragment">🎍 Tests are about <b>confidence</b></li>
      <li class="fragment">🙅‍♀️ Nobody like to review huge snapshots</li>
      <li class="fragment">👍 Use something else! (or <code>shallowMount</code>)</li>
    </ul>
    <br>
    <p class="fragment">👌 eslint: <a href="https://github.com/jest-community/eslint-plugin-jest/blob/master/docs/rules/no-large-snapshots.md" target="_blank" rel="noopener noreferrer">jest/no-large-snapshots (default: 12 lines)</a></p>
  </section>
</section>
<section>
  <section>
    <h2>Integration test</h2>
    <img src="./img/unit-vs-integration.gif" class="fragment" alt="unit vs. integration test" style="width: 80%;">
  </section>
  <section>
    <h2>Example in Vue.js</h2>
    <pre>
      <code>
import { mount, createLocalVue } from '@vue/test-utils'
import VueRouter from 'vue-router'

const localVue = createLocalVue()

localVue.use(VueRouter)
localVue.use(Vuex)
const router = new VueRouter()

const store = new Vuex.Store({
  state: {},
})

mount(Component, {
  localVue,
  router,
  store,
})
      </code>
    </pre>
  </section>
  <section>
    <h2>About: Async tests</h2>
    <pre class="fragment">
      <code class="javascript" data-trim data-noescape>
test('should render an page with data', async () => {
  <mark>expect.assertions(2)</mark>

  const wrapper = mount(StudentList, {
    localVue,
    router,
    store,
    sync: false,
  })
  <mark>await flushPromises()</mark>
  
  expect(wrapper.html()).toMatchSnapshot()
  // extra security (avoid empty table in snapshot)
  expect(wrapper.text()).toContain('Ralph Wiggum')
})

      </code>
      <code>
const flushPromises = () => new Promise(resolve => setTimeout(resolve));
      </code>
    </pre>
  </section>
  <section>
    <section>
      <h2>Mocks</h2>
    </section>
    <ul class="unstyled">
      <li class="fragment">👎 Mocks sucks</li>
      <img src="./img/mocks-reality.png" style="width: 70%" class="fragment" alt="Every time we mock, we diverge from the real world scenario.">
      <li class="fragment">🤝 Ok for:</li>
      <ul class="unstyled">
        <li class="fragment">External calls (HTTP GET/POST/...)</li>
        <li class="fragment">Browsers API (local/session storage, navigator...)</li>
      </ul>
    </ul>
    <aside class="notes">
      mock sucks. avoid them as much as posible.
      Every time we mock, we diverge from the real world scenario.
      only for external calls (HTTP GET/POST/...) and browsers API (local/session storage, navigator...)    
    </aside>
  </section>
  <section>
    <h2>Mount vs. ShallowMount</h2>
  </section>
</section>
<!-- <section>
  <section>
    <h2>e2e</h2>
  </section>
  <section>
    <h2>example</h2>
    ... complicated test...
  </section>
  <section>
    <h2>Chrome --headless</h2>
    <h3>A new game changer</h3>
  </section>
</section> -->
<section>
  <section>
    <h2>Working together</h2>
  </section>
  <section data-background="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRM6GwuL_ubkAVrDBkZ5D2trpo1Mgn82H1gneU_LSv25lb6qIrt">
    <h2 style="text-shadow: 1px 1px 4px rgba(34,34,34,.6);">The importance of automation</h2>
    <aside class="notes">
      every code change must be sent through PR. No commit on master.
      automatically trigger build on PR
      coverage thresholds for new code
      if test fail, don't remove it. Fix it!
    </aside>
  </section>
  <section>
    <h2>👌 Following cc evolution</h2>
    <img src="./img/coverage-evolution.png" alt="Following cc evolution" style="width: 70%;">
    <p><a href="https://github.com/maxpou/gitvub/pull/36" target="_blank" rel="noopener noreferrer"><i class="fa fa-github"></i> github.com/maxpou/gitvub/pull/36</a></p>
  </section>
  <section>
    <h3>Low coverage on your team?</h3>
    <div class="fragment">
      <h2><span class="text-info-bold">Totem Team</span></h2>
      <img src="./img/totem.png" alt="totem">
    </div>
  </section>
</section>
<section>
  <section>
    <h3>Don't forget...</h3>
    <h2 class="fragment">we write tests to catch bugs 🐛</h2>
  </section>
  <section>
    <h3>If your test is red,</h3>
    <h2 class="fragment" data-fragment-index="0">don't delete it, <span class="text-info-bold">fix it!</span></h2>
    <pre class="fragment" data-fragment-index="0">
      <code class="javascript" data-trim data-noescape>
// it('should...', () => {
//   expect(actions.resetStore).toHaveBeenCalled();
//   expect(actions.getXXX).toHaveBeenCalled();
//   expect(actions.getYYY).toHaveBeenCalled();
// });
      </code>
    </pre>
  </section>
  <section>
    <h2>Too many tools?</h2>
    <img src="./img/plumber.png" alt="Who want to hire plumber who only use a screwdriver?">
  </section>
  <section>
    <h1>🙏</h1>
    <h3>Testing is not a "nice to have"</h3>
    <h2>It's a <span class="text-info-bold">delivrable</span></h2>
  </section>
</section>
<section>
  <h2>Thank you!</h2>
</section>
<section>
  <section>
    <h2>Backup</h2>  
  </section>
  <section>
    <a href="https://www.youtube.com/watch?v=zqdCM8zR6Mc">Jason Lengstorf – Building a testing- and quality-driven culture at IBM</a>
  </section>
</section>
</div>
</div>
<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available at:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
  controls: false,
  progress: true,
  slideNumber: true,
  history: true,

  transition: 'fade', // none/fade/slide/convex/concave/zoom

  // Optional reveal.js plugins
  dependencies: [
    { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
    { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
    { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
    { src: 'reveal.js/plugin/notes/notes.js', async: true }
  ]
});

</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67868977-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
